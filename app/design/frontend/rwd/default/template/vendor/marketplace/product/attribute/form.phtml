<?php
$groups = $this->getAttributeGroups()->getData();
$attribute = $this->getAttribute()->getData();

if($attribute){
    $selectedgroup = $this->getAttributeSelectedGroup();
}

?>
<form method="post" action="<?php echo $this->getEditAttributeUrl();;?>">
    <h2>Attribute Properties</h2>
    <h4 class="icon-head head-edit-form fieldset-legend">Manage Titles (Size, Color, etc.)</h4>
    <table class="data-table">
        <tr>
            <td>Select Group</td>
            <td><select id="group" name="group">
                    <option value="">--Please Select--</option>
                    <?php foreach($groups as $group): ?>
                    <option value="<?php echo $group['attribute_group_id'] ?>"
                        <?php if($selectedgroup == $group['attribute_group_id']): ?>selected <?php endif; ?>>
                        <?php echo $group['attribute_group_name'] ?>
                    </option>
                    <?php endforeach; ?>
                </select></td>
        </tr>
        <tr>
            <td><label>Frontend Label</label></td>
            <td>
                <input class="input-text required-option" type="text" name="frontend_label"
                    value="<?php echo $attribute['frontend_label']; ?>">
            </td>
        </tr>
        <tr>
            <td><label>Input Type</label></td>
            <td>
                <select id="frontend_input" name="frontend_input" title="Catalog Input Type for Store Owner"
                    class=" select" onclick="checkOptionsPanelVisibility();">
                    <option value="text" selected="selected"
                        <?php if($attribute['frontend_input'] == 'text'): ?>selected <?php endif; ?>>Text Field</option>
                    <option value="textarea" <?php if($attribute['frontend_input'] == 'textarea'): ?>selected
                        <?php endif; ?>>Text Area</option>
                    <option value="date" <?php if($attribute['frontend_input'] == 'date'): ?>selected <?php endif; ?>>
                        Date</option>
                    <option value="boolean" <?php if($attribute['frontend_input'] == 'boolean'): ?>selected
                        <?php endif; ?>>Yes/No</option>
                    <option value="multiselect" <?php if($attribute['frontend_input'] == 'multiselect'): ?>selected
                        <?php endif; ?>>Multiple Select</option>
                    <option value="select" <?php if($attribute['frontend_input'] == 'select'): ?>selected
                        <?php endif; ?>>Dropdown</option>
                    <option value="price" <?php if($attribute['frontend_input'] == 'price'): ?>selected <?php endif; ?>>
                        Price</option>
                    <option value="media_image" <?php if($attribute['frontend_input'] == 'media_image'): ?>selected
                        <?php endif; ?>>Media Image</option>
                    <option value="weee" <?php if($attribute['frontend_input'] == 'weee'): ?>selected <?php endif; ?>>
                        Fixed Product Tax</option>
                </select>
            </td>

        </tr>
        <tr>
            <td class="label"><label for="default_value_text">Default Value</label></td>
            <td class="value"><input id="default_value_text" name="default_value_text"
                    value="<?php echo $attribute['default_value'] ?>" title="Default Value" type="text"
                    class=" input-text"></td>
        </tr>

        <tr>
            <td class="label"><label for="is_required">Values Required</label></td>
            <td class="value">
                <select id="is_required" name="is_required" title="Values Required" class=" select">
                    <option value="1" <?php if($attribute['is_required']==1):?>selected <?php endif?>>Yes</option>
                    <option value="0" <?php if($attribute['is_required']==0):?>selected <?php endif?>>No</option>
                </select>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="entity-edit" id="matage-options-panel" style="display:none">
        <div class="entry-edit-head">
            <h4 class="icon-head head-edit-form fieldset-legend">Manage Options (values of your attribute)</h4>
        </div>
        <div class="box">
            <div class="hor-scroll">
                <table class="dynamic-grid" cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr id="attribute-options-table">
                            <th>Option</th>
                            <th>
                                <button id="add_new_option_button" title="Add Option" type="button" class="scalable add"
                                    onclick="" style="">
                                    <span><span><span>Add Option</span></span></span></button>
                            </th>
                        </tr>

                    </tbody>
                </table>
            </div>
            <input type="hidden" id="option-count-check" value="">
        </div>
    </div>
    <input type="submit" value="Save" class="button">
</form>
<script type="text/javascript">
//<![CDATA[
var optionDefaultInputType = 'radio';

// IE removes quotes from element.innerHTML whenever it thinks they're not needed, which breaks html.
var templateText =
    '<tr class="option-row">' +
    '<td><input name="option[value][{{id}}][0]" value="{{store0}}" class="input-text required-option" type="text" /><\/td>' +
    '<td class="a-left" id="delete_button_container_{{id}}">' +
    '<input type="hidden" class="delete-flag" name="option[delete][{{id}}]" value="" />' +
    '<button  id="id_9760c62871e0a0613f362be4f280032f" title="Delete" type="button" class="scalable delete delete-option" onclick="" style=""><span><span><span>Delete</span></span></span></button>' +
    '<\/td>' +
    '<\/tr>';

var attributeOption = {
    table: $('attribute-options-table'),
    templateSyntax: /(^|.|\r|\n)({{(\w+)}})/,
    templateText: templateText,
    itemCount: 0,
    totalItems: 0,
    isReadOnly: 0,
    add: function(data) {
        this.template = new Template(this.templateText, this.templateSyntax);
        var isNewOption = false;
        if (!data.id) {
            data = {};
            data.id = 'option_' + this.itemCount;
            isNewOption = true;
        }
        if (!data.intype)
            data.intype = optionDefaultInputType;
        Element.insert(this.table, {
            after: this.template.evaluate(data)
        });
        if (isNewOption && !this.isReadOnly) {
            this.enableNewOptionDeleteButton(data.id);
        }
        this.bindRemoveButtons();
        this.itemCount++;
        this.totalItems++;
        this.updateItemsCountField();
    },
    remove: function(event) {
        var element = $(Event.findElement(event, 'tr')); // !!! Button already
        // have table parent in safari
        // Safari workaround
        element.ancestors().each(function(parentItem) {
            if (parentItem.hasClassName('option-row')) {
                element = parentItem;
                throw $break;
            } else if (parentItem.hasClassName('box')) {
                throw $break;
            }
        });


        if (element) {
            var elementFlags = element.getElementsByClassName('delete-flag');
            if (elementFlags[0]) {
                elementFlags[0].value = 1;
            }

            element.addClassName('no-display');
            element.addClassName('template');
            element.hide();
            this.totalItems--;
            this.updateItemsCountField();
        }
    },
    updateItemsCountField: function() {
        if (this.totalItems > 0) {
            $('option-count-check').value = '1';
        } else {
            $('option-count-check').value = '';
        }
    },
    enableNewOptionDeleteButton: function(id) {
        $$('#delete_button_container_' + id + ' button').each(function(button) {
            button.enable();
            button.removeClassName('disabled');
        });
    },
    bindRemoveButtons: function() {
        var buttons = $$('.delete-option');
        for (var i = 0; i < buttons.length; i++) {
            if (!$(buttons[i]).binded) {
                $(buttons[i]).binded = true;
                Event.observe(buttons[i], 'click', this.remove.bind(this));
            }
        }
    }

}

if ($('row-template')) {
    $('row-template').remove();
}
attributeOption.bindRemoveButtons();

if ($('add_new_option_button')) {
    Event.observe('add_new_option_button', 'click', attributeOption.add.bind(attributeOption));
}
Validation.addAllThese([
    ['required-option', 'Failed', function(v) {
        return !Validation.get('IsEmpty').test(v);
    }]
]);
Validation.addAllThese([
    ['required-options-count', 'Options is required', function(v) {
        return !Validation.get('IsEmpty').test(v);
    }]
]);
<?php if($attribute):?>
<?php foreach ($this->getOptionValues() as $_value) : ?>
attributeOption.add(<?php echo $_value->toJson() ?>);
<?php endforeach; ?>
<?php endif; ?>

function checkOptionsPanelVisibility() {
    if ($('matage-options-panel')) {
        var panel = $('matage-options-panel');
        if ($('frontend_input') && ($('frontend_input').value == 'select' || $('frontend_input').value ==
                'multiselect')) {
            panel.show();
        } else {
            panel.hide();

        }
    }
}

//]]>
</script>
</div>